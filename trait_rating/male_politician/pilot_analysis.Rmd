---
title: "pilot.analysis"
output: html_document
date: "2024-11-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading necessary library
```{r loading library}
library(tidyverse)
library(haven)
library(readr)
library(dplyr)
library(pwr)
library(effsize)
```
## Data Processing 

### PART 1: Create an empty data frame to hold all the data
```{r}
# Define the directory path and List all CSV files in the directory
file_path <- "/Users/thwenwehan/Desktop/data/trait_rating/male_politician/Data_118_2missing"
file_list <- list.files(file_path, pattern = "\\.CSV$", full.names = TRUE)
```


```{r}
sam_dat <- read.table(file_list[1], header = FALSE, sep = ",", fill = TRUE, stringsAsFactors = FALSE)
sam_dat1 <- sam_dat[-c(1:3,17,18),]
```


### Loop through each file and exclude demographic exclusion criteria
```{r}
big_dat_files <- character()  # Initialize as an empty character vector
excluded_demog_count <- 0


for (file in file_list) {
  
  # Read the CSV file
  initial_dat <- read.table(file, header = FALSE, sep = ",", fill = TRUE, stringsAsFactors = FALSE)
  
  # Check exclusion criteria: Age under 18 or education level less than high school
  if (initial_dat[18, 2] < 18 || initial_dat[18, 5] == 1) {
    # Increment the excluded count
    excluded_demog_count <- excluded_demog_count + 1
  } else {
    # Add the file to the included list
    big_dat_files <- c(big_dat_files, file)
  }
}

# Print the count of excluded participants
cat("Number of excluded participants according to Age and Education Level:", excluded_demog_count, "\n")
```
    
### Loop through each file to create a meta data frame
```{r}
big_data <- data.frame()
for (file in big_dat_files) {
  
  # Read the CSV file
  dat <- read.table(file, header = FALSE, sep = ",", fill = TRUE, stringsAsFactors = FALSE)
  
  # 1. Delete the two row
  dat <- dat[-c(1:3,17,18),]

  # 2. Transpose the remaining rows
  transposed_data <- t(dat)
    
  # 3. Convert to a data frame and set the first row as column names
  transposed_data <- as.data.frame(transposed_data, stringsAsFactors = FALSE)
  colnames(transposed_data) <- transposed_data[1, ]  # Set first row as column names
  transposed_data <- transposed_data[-2, ]  # Remove the first row after setting as header
  
  # 4. Add an "ID" column with the file name as the identifier
  file_name <- sub("\\.CSV$", "", basename(file))  # Extract file name without extension
  transposed_data$ID <- file_name  # Assign file name to ID column
    
  # 5. Reorder to make "ID" the first column
  transposed_data <- transposed_data[, c(ncol(transposed_data), 1:(ncol(transposed_data) - 1))]
    
  # 6. Append this data to the big dataset
  big_data <- bind_rows(big_data, transposed_data)
}


# View the final bribe_data
head(big_data)
```




## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
